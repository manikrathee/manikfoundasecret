<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Manik Found a Secret!</title>
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="style.css" type="text/css" rel="stylesheet" />
</head>
<body>

<div id="island">
	<div class="torch"></div>
	<div class="torch"></div>
	<div class="torch"></div>
	<div class="torch"></div>
	<div id="treasure"></div>
</div>
<div id="bridge"></div>

<div id="wrapper">
	<div id="text"></div>
	<div id="manik"></div>
</div>


<div id="gloom"></div>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
<script>
	
(function($){
	var audio = new Audio('secret.wav'),
		torchAudio = new Audio('torch.wav'),
		h1 = $('h1'),
		revealer = $('#revealer'),
		manik = $('#manik'),
		torches = $('.torch'),
		gloom = $('#gloom'),
		text = $('#text');
		
	function waitForAudioToBegin() {
		if (audio.currentTime === 0) {
			setTimeout(waitForAudioToBegin, 10);
			return;
		}
		reveal();
	}
	
	function waitForTorchSound() {
		if (torchAudio.currentTime === 0) {
			setTimeout(waitForTorchSound, 5);
			return;
		}
		//begin the animation
		lightsOn();
	}
	
	function reveal(callback) {
		h1.show();
		text.addClass('go');
		revealer.addClass('go');
		manik.addClass('go');
	}
	
	function lightsOn(callback) {
		gloom.addClass('fading');
		torches.addClass('on-fire');
		setTimeout(function() {
			audio.play();
			waitForAudioToBegin();
		}, 1000);
	}
	
	//kick it off
	setTimeout(function() {
		torchAudio.play();
		waitForTorchSound();
	}, 800);
})(jQuery);
</script>
</body>
</html>