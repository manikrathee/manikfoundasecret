<!DOCTYPE html>
<html lang="en">
<!--



â™¥



-->
<meta http-equiv="refresh" content="#WAIT; url=http://manikfoundasecret.number61.net/">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Manik Found a Secret!</title>
	<meta name="description" content="" />
	<meta name="author" content="Matthew Gipp" />
	<link href="http://manikfoundasecret.number61.net/style.css" type="text/css" rel="stylesheet" />
</head>
<body>

<div id="cave">
	<div class="torch"></div>
	<div class="torch"></div>
	<div id="treasure">
		<div>
			<a href="#"></a>
		</div>
	</div>

	<div id="manik">
		<div class="sprite"></div>
	</div>
	
	<div id="arch"></div>
</div>


<div id="gloom"></div>
<div id="text"></div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
<script>
(function( $ ){
	var	manik = $('#manik');
	var	cave = $('#cave');
	var	torches = $('.torch');
	var	gloom = $('#gloom');
	var	text = $('#text');
	var treasure = $('#treasure');

	var iframe = treasure.find('iframe');
	var treasureLink = treasure.find('a');

	var secretSound = new Audio();
	var torchSound = new Audio();
	var itemSound = new Audio();
	var chestSound = new Audio();
	var secretSoundReady = false;
	var torchSoundReady = false;
	var itemSoundReady = false;
	var chestSoundReady = false;


	secretSound.addEventListener('canplaythrough', (function(){secretSoundReady = true;}), false);
	torchSound.addEventListener('canplaythrough', (function(){torchSoundReady = true;}), false);
	itemSound.addEventListener('canplaythrough', (function(){itemSoundReady = true;}), false);
	chestSound.addEventListener('canplaythrough', (function(){chestSoundReady = true;}), false);

	var THUMBNAIL = window.location.search.split('=')[1] ? window.location.search.split('=')[1] : 'http://www.manikrathee.com/resources.php';

	if (THUMBNAIL) {
		treasureLink.attr('href', THUMBNAIL);
	}

	secretSound.src = 'http://manikfoundasecret.number61.net/sounds/secret.wav';
	torchSound.src = 'http://manikfoundasecret.number61.net/sounds/torch.wav';
	itemSound.src = 'http://manikfoundasecret.number61.net/sounds/item.wav';
	chestSound.src = 'http://manikfoundasecret.number61.net/sounds/chest.wav';


	function step1() {
		if (!secretSoundReady || !torchSoundReady || !itemSoundReady || !chestSoundReady) {
			setTimeout(step1, 30);
			return;
		}

		step2();
	}

	function step2() {
		manik.addClass('step-1 walking');
		
		setTimeout(function() {
			manik.removeClass('walking');
			
			torchSound.play();
			lightsOn();
			
			setTimeout(function() {
				secretSound.play();
			}, 1000);

			treasure.on('click', step3);
			
		}, 1200);
	}

	// add a handler to the chest
	function step3() {

		manik.addClass('walking step-2').removeClass('step-1');

		setTimeout(function() {
			chestSound.play();
			treasure.addClass('open');
			manik.removeClass('walking');
			text.addClass('visible');

			treasure.off('click', step3);
			
			setTimeout(function() {
				itemSound.play();
			}, 100);
		}, 380);
	}	
	


	function lightsOn() {
		torches.addClass('on-fire');
		gloom.addClass('full-light');
	}

	cave.on('click', '.torch', function() {
		$(this).toggleClass('on-fire');
		torchSound.play();
		
		if ($('.on-fire').length === 0 ) {
			gloom.removeClass('full-light half-light');
		} else if ($('.on-fire').length === 1 ) {
			gloom.removeClass('full-light').addClass('half-light');
		} else {
			gloom.removeClass('half-light').addClass('full-light');
		}
	});


	step1();
})( jQuery );
</script>
</body>
</html>